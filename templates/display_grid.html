<!DOCTYPE html>
<html>
<head>
    <title>Display Grid</title>
    <style>
        /* Center the grid layout */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensure the body takes up at least the full height of the viewport */
            margin: 0; /* Remove default body margin */
            font-family: Arial, sans-serif;
        }

        /* Grid styling */
        .grid-container {
            display: grid;
            grid-template-columns: repeat({{ width }}, 40px); /* Set width of each column */
            grid-template-rows: repeat({{ height }}, 40px); /* Set height of each row */
            gap: 2px;
            margin-right: 20px; /* Add margin to align it with other elements */
        }

        .grid-cell {
            position: relative;
            width: 40px; /* Adjust cell width as needed */
            height: 40px; /* Adjust cell height as needed */
            border: 1px solid #ccc;
            cursor: pointer;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: absolute; /* Position modal absolute */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent background */
            z-index: 1;
        }

        .modal-content {
            background-color: #fefefe;
            padding: 20px;
            border: 1px solid #888;
            width: 200px; /* Set modal width */
            position: absolute; /* Position modal content absolute */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center modal content */
        }

        .menu-item {
            margin-bottom: 10px; /* Add margin between menu items */
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="grid-container">
        <!-- Generate grid cells using a loop -->
        {% for i in range(height) %}
            {% for j in range(width) %}
                <div class="grid-cell">
                    <!-- Check if cell content exists in cell_contents dictionary -->
                    {% if (i, j) in cell_contents %}
                        {{ cell_contents[(i, j)] }}
                    {% endif %}
                    <div class="modal">
                        <div class="modal-content">
                            <!-- Menu items -->
                            <div class="menu-item">Tomatoes</div>
                            <div class="menu-item">Cherries</div>
                            <!-- Add more menu items as needed -->
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% endfor %}
    </div>

    <script>
        // Add event listener to each grid cell
        document.querySelectorAll('.grid-cell').forEach(cell => {
            cell.addEventListener('click', function() {
                // Toggle the visibility of the modal associated with this cell
                const modal = this.querySelector('.modal');
                modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
            });
        });

        // Add event listener to each menu item
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                const selectedItem = this.textContent; // Get the selected item
                const modal = this.closest('.modal'); // Find the modal containing this item
                const gridCell = modal.parentElement; // Find the grid cell containing this modal
                const gridId = gridCell.dataset.gridId; // Get the grid ID
                const cellContent = selectedItem; // Set the new content for the grid cell

                // Send an AJAX request to update the grid cell in the database
                fetch('/update_grid_cell', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: new URLSearchParams({
                        grid_id: gridId,
                        cell_content: cellContent
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    // Optionally, handle success response
                    console.log('Grid cell updated successfully');
                })
                .catch(error => {
                    console.error('Error updating grid cell:', error);
                    // Optionally, display an error message to the user
                });

                // Update the content of the grid cell immediately (optimistic update)
                gridCell.textContent = cellContent;

                // Hide the modal
                modal.style.display = 'none';
            });
        });
    </script>
</body>
</html>
